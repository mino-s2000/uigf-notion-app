# 📊 ダッシュボード（設定用 DB）の詳細設定

設定用 DB は、インポートされた膨大なガチャ履歴を UID ごとに集計し、**「アカウントの要約カード」**として表示するための場所です。

## 1. 統計用プロパティの作成（数式）

「設定用 DB」に以下の数式プロパティを追加してください。Notion の「関数 (Formula)」型を選択し、各数式を入力します。

### ① 合計ガチャ回数

アカウント全体の累計ガチャ回数を算出します。

- **プロパティ名**: `合計ガチャ回数`
- **数式**:
  ```javascript
  prop("Gacha Logs").length();
  ```

### ② 星 5 当選数

星 5 をいくつ引いたかを算出します。

- **プロパティ名**: `★5数`
- **数式**:
  ```javascript
  prop("Gacha Logs")
    .filter(current.prop("Rank") == "5")
    .length();
  ```

### ③ 「ガチャ種別名」プロパティ（関数型）

数値（301, 200 等）を分かりやすい名前に変換します。

- **名前**: `ガチャ名`
- **数式**:
  ```javascript
  let(
    type,
    prop("Gacha Type"),
    ifs(
      type == "500",
      "集録祈願",
      type == "301" || type == "400",
      "イベント祈願・キャラクター",
      type == "302",
      "イベント祈願・武器",
      type == "200",
      "通常祈願",
      type == "100",
      "初心者祈願",
      "その他"
    )
  );
  ```

### ④ 平均幸運度（★5 排出率）

星 5 ひとつあたり何連かかっているかの平均を出します。

- **プロパティ名**: `平均運`
- **数式**:
  ```javascript
  let(count, prop("★5数"),
    if(count > 0,
      round(prop("合計ガチャ回数") / count * 10) / 10 + " 連/★5",
      "データなし"
    )
  )
  ```

### ⑤ ガチャ内訳（視覚化）

限定キャラ・武器・恒常などの内訳を簡易的に表示します。

- **プロパティ名**: `内訳`
- **数式**:
  ```javascript
  "限定キャラ: " +
    prop("Gacha Logs")
      .filter(
        current.prop("Gacha Type") == "301" ||
          current.prop("Gacha Type") == "400"
      )
      .length() +
    " / 限定武器: " +
    prop("Gacha Logs")
      .filter(current.prop("Gacha Type") == "302")
      .length() +
    " / 通常祈願: " +
    prop("Gacha Logs")
      .filter(current.prop("Gacha Type") == "200")
      .length() +
    " / 集録祈願: " +
    prop("Gacha Logs")
      .filter(current.prop("Gacha Type") == "500")
      .length();
  ```

---

## 2. ギャラリービューの見栄え設定

設定用 DB のビューを「ギャラリー」に変更し、以下の設定を行うことでダッシュボード化します。

1.  **カードプレビュー**: `なし`（または、各ゲームの壁紙を「画像」プロパティに設定して表示）
2.  **カードサイズ**: `中`
3.  **表示するプロパティ**:
    - `Game`（セレクト型）
    - `UID`
    - `合計ガチャ回数`
    - `★5数`
    - `平均運`
4.  **カードの並び替え**: `Game` ごとにグループ化するか、`名前` で昇順に設定。

---

## 3. 【応用】特定のガチャ種別の「現在の天井まで」を表示する

もし「限定キャラ祈願の天井まであと何連か」を表示したい場合は、以下の数式を応用します。
※注：これは「ガチャ履歴 DB」にインポートする際、Python 側で「前回の星 5 からの経過数（Pity）」を計算して数値プロパティに保存している場合に有効です。

- **プロパティ名**: `天井まで（限定キャラ）`
- **数式例**:

  ```javascript
  "あと " +
    (90 -
      prop("Gacha Logs")
        .filter(current.prop("Gacha Type") == "301")
        .last()
        .prop("Pity")) +
    " 連";
  ```

- **プロパティ名**: `天井まで（限定武器）`
- **数式例**:
  ```javascript
  "あと " +
    (90 -
      prop("Gacha Logs")
        .filter(current.prop("Gacha Type") == "302")
        .last()
        .prop("Pity")) +
    " 連";
  ```

---

> [!TIP]
> このダッシュボードを見るだけで、どのアカウントが最も幸運か、次の天井がいつかを確認できます。複数の UID を持つユーザー（メイン垢・サブ垢・他ゲーム）にとって、最強の管理パネルになります。
